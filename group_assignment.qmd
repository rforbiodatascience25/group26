---
title: "group_assignment"
authors:   
    - "s252641 - Bhavya Gudhka"   
    - "s215065 - Henrik Servais Janssen Knudsen"   
    - "s253705 - Lun Su≈°a"   

format:
  html:     
    embed-resources: true 
editor: visual 
execute:   
  warning: false   
  message: false 
---

### US Arrests - Data description

The dataset contains statistics about the arrests made per 100,000 residents in 50 states of US in 1973. The arrests are categorised into assault, murder, and rape. It also includes urban population percentage for different states. We carry out PCA on this data to reduce its dimensions and identify some patterns.

# PCA

#### Libraries

```{r}
library("tidyverse")
library("broom")
library("cowplot")
library("ggplot2")
```

#### Load data and PCA

```{r}
<<<<<<< HEAD
# Load the dataset
data(USArrests)

# View the data
head(USArrests)

# Perform PCA (scaling is important!)
pca_result <- prcomp(USArrests, scale = TRUE)

# View summary
summary(pca_result)

# Create a biplot
biplot(pca_result, scale = 0)

# Scree plot to see variance explained
plot(pca_result$sdev^2 / sum(pca_result$sdev^2), 
     type = "b", 
     xlab = "Principal Component", 
     ylab = "Proportion of Variance Explained")

```

```{r}

# Perform PCA
pca_fit <- USArrests |> 
  select(where(is.numeric)) |> # retain only numeric columns
  prcomp(scale = TRUE) # do PCA on scaled data

# Plot without the outcome variable
pca_fit |>
  augment(USArrests) |> 
  ggplot(aes(.fittedPC1, .fittedPC2)) + 
  geom_point(size = 1.5, color = "#0072B2") +
  geom_text(aes(label = rownames(USArrests)), 
            size = 3, vjust = -0.5, hjust = 0.5) +  # Add state labels
  theme_half_open(12) + 
  background_grid()
```

```{r}

# Perform PCA
pca_fit <- USArrests |> 
  select(where(is.numeric)) |> # retain only numeric columns
  prcomp(scale = TRUE) # do PCA on scaled data

# Extract the rotation matrix (loadings) for arrows
arrow_data <- pca_fit |>
  tidy(matrix = "rotation") |>
  pivot_wider(names_from = "PC", 
              names_prefix = "PC", 
              values_from = "value") |>
  mutate(PC1 = PC1 * 5,  # Scale arrows for visibility
         PC2 = PC2 * 5)

# Plot with arrows
pca_fit |>
  augment(USArrests) |> 
  ggplot(aes(.fittedPC1, .fittedPC2)) + 
  geom_point(size = 1.5, color = "#0072B2") +
  geom_text(aes(label = rownames(USArrests)), 
            size = 3, vjust = -0.5, hjust = 0.5) +
  # Add arrows for variable loadings
  geom_segment(data = arrow_data,
               aes(x = 0, y = 0, xend = PC1, yend = PC2),
               arrow = arrow(length = unit(0.3, "cm")),
               color = "#D55E00",
               linewidth = 1) +
  # Add labels for arrows
  geom_text(data = arrow_data,
            aes(x = PC1, y = PC2, label = column),
            color = "#D55E00",
            size = 4,
            fontface = "bold",
            vjust = -0.5) +
  theme_half_open(12) + 
  background_grid() +
  labs(title = "PCA Biplot of USArrests",
       x = "PC1",
       y = "PC2")
```

```{r}
pca_fit |>
  tidy(matrix = "eigenvalues") |>
  ggplot(aes(PC, percent)) +
  geom_col(fill = "#56B4E9", alpha = 0.8) +
  scale_x_continuous(breaks = 1:4) +  # Changed to 1:4 since USArrests has 4 variables
  scale_y_continuous(
    labels = scales::percent_format(),
    expand = expansion(mult = c(0, 0.01))
  ) +
  theme_minimal_hgrid(12) +
  labs(title = "Scree Plot: \nVariance Explained by Principal Components",
       x = "Principal Component",
       y = "Percent Variance Explained")
```
